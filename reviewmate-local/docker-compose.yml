version: '3.9'

services:
  mongo:
    image: mongo:6.0
    container_name: reviewmate-mongo
    restart: unless-stopped
    environment:
      MONGO_INITDB_DATABASE: reviewmate
    ports:
      - '27017:27017'
    volumes:
      - mongo_data:/data/db
    networks:
      - internal

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: reviewmate-backend
    environment:
      PORT: 5001
      MONGODB_URI: mongodb://mongo:27017/reviewmate
      NODE_ENV: development
      JWT_SECRET: dev-jwt-secret
      GITHUB_TOKEN_SECRET: dev-token-secret
      CLIENT_ORIGIN: http://localhost:3000
    ports:
      - '5001:5001'
    depends_on:
      - mongo
    volumes:
      - ./backend:/app
      - backend_node_modules:/app/node_modules
    networks:
      - internal
      - web

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_URL: /api
        VITE_SOCKET_URL: http://backend:5001
    container_name: reviewmate-frontend
    ports:
      - '3000:3000'
    depends_on:
      - backend
    volumes:
      - ./frontend/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - web

volumes:
  mongo_data:
  backend_node_modules:

networks:
  internal:
  web:
